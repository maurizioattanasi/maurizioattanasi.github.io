---
layout: post
title: 
date: '2013-08-01T17:42:00.000+02:00'
author: Maurizio Attanasi
tags:
- Version Control Systems
- Ambienti di sviluppo
modified_time: '2013-08-01T17:42:12.606+02:00'
thumbnail: http://1.bp.blogspot.com/-QCvL3_KB7LA/Ufp6xwgLSOI/AAAAAAAADBg/sfgMC_FYHdQ/s72-c/VS_Add_Existing_Project.jpg
blogger_id: tag:blogger.com,1999:blog-2699321970282050013.post-4969164282984613193
blogger_orig_url: https://maurizioattanasi.blogspot.com/2013/08/utilizzo-dei-subrepositories-di.html
---

<h1 style="-webkit-font-smoothing: antialiased; border: 0px; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 28px; margin: 0px 0px 10px; padding: 0px;">Utilizzo dei subrepositories di Mercurial</h1><div style="border: 0px; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; margin-bottom: 15px; margin-top: 10px; padding: 0px; text-align: justify;">Scrivo questa nota con l'intento di riassumere le informazioni, spesso contraddittorie e parziali, sull'argomento raccolte sulla rete. Il fine di tale strumento, o almeno una delle finalità principali, è quella di favorire,&nbsp;a chi già fa uso del DVCS in esame,&nbsp;il riutilizzo in più progetti di componenti già sviluppati in precedenza.&nbsp;Al tal fine,&nbsp;&nbsp;nel seguito della nota,&nbsp;propongo un esempio concreto dei passi da seguire per integrare un subrepository, contenente uno o più moduli già implementati, in &nbsp;un nuovo progetto sviluppato, ad esempio, con l'IDE di Microsoft, il Visual Studio 2012. Supponiamo che il subrepository in esame &nbsp;si chiami&nbsp;<strong style="border: 0px; margin: 0px; padding: 0px;">XYZ_Core Project</strong><span style="border: 0px; margin: 0px; padding: 0px;">.</span></div><div style="border: 0px; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; margin-bottom: 15px; margin-top: 10px; padding: 0px; text-align: justify;">Il primo passo consiste nella creazione di una struttura di cartelle del tipo:</div><blockquote style="border-left-color: rgb(221, 221, 221); border-left-style: solid; border-width: 0px 0px 0px 4px; color: #777777; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; margin: 15px 0px; padding: 0px 15px;"><div style="border: 0px; margin-bottom: 15px; padding: 0px;"><strong style="border: 0px; margin: 0px; padding: 0px;">NEW Project</strong><br />|<strong style="border: 0px; margin: 0px; padding: 0px;">_SRC</strong></div><ol style="border: 0px; margin: 15px 0px 0px; padding: 0px 0px 0px 30px;"><li style="border: 0px; margin: 0px; padding: 0px;">Nella cartella&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">SRC, creiamo una&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">solution</em>&nbsp;vuota di Visual Studio con il nome del progetto che stiamo creando, ovvero&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">NEW Project</code>.<br />A questo punto, la struttura delle cartelle sarà:<br /><span style="border: 0px; margin: 0px; padding: 0px;"><b>NEW Project<span style="border: 0px; margin: 0px; padding: 0px;"><br />|--</span></b></span></em><span style="border: 0px; margin: 0px; padding: 0px;"><b>SRC<span style="border: 0px; margin: 0px; padding: 0px;"><br />|----</span>NEW Project</b></span></li><li style="border: 0px; margin: 0px; padding: 0px;"><div class="separator" style="clear: both; text-align: justify;">Apriamo un prompt dei comandi, &nbsp;spostiamoci nella sottocartella &nbsp;<b>_SRC\NEW Project&nbsp;</b>e cloniamo il repository <code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">xyz_core-project</code></div><div style="border: 0px; margin-bottom: 15px; padding: 0px;"><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">$: hg clone https://bitbucket.org/***/xyz_core-project</code>;<br />Ottenuti i progetti del subrepository, non resta che aggiungerli alla nostra solution:<br /><a href="http://1.bp.blogspot.com/-QCvL3_KB7LA/Ufp6xwgLSOI/AAAAAAAADBg/sfgMC_FYHdQ/s1600/VS_Add_Existing_Project.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://1.bp.blogspot.com/-QCvL3_KB7LA/Ufp6xwgLSOI/AAAAAAAADBg/sfgMC_FYHdQ/s1600/VS_Add_Existing_Project.jpg" height="237" width="320" /></a></div></li><li style="border: 0px; margin: 0px; padding: 0px;"><div style="border: 0px; margin-bottom: 15px; padding: 0px;">Fatto ciò, torniamo nella cartella root del progetto, ed aggiungiamo il file&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">.hgignore</code>&nbsp;adatto alla versione di Visual Studio utilizzata, ed un nuovo file, denominato&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">.hgsub</code>&nbsp;strutturato come segue:<br /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">_SRC/NEW Project/xyz_core-project=xyz_core-project</code><br /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">[subpath]</code><br /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">(https://(?:[^@]+@)?bitbucket\.org/[^/]+)(/[^/]+)/(.*) = \1/\3</code><br />Il file appena aggiunto è quello che indica al nostro DVCS che è presente un subrepository. Spendiamo un attimo per capire il conenuto di tale file:<br />- A sinistra del segno di uguaglianza, troviamo il percorso relativo alla root del progetto principale, nel quale intendiamo inserire il subrepository;<br />- A destra dell'uguaglianza c'è il nome simbolico del subrepository.<br />- Sotto la chiave&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">[subpath]</em>&nbsp;viene specificato, mediante una&nbsp;<span style="border: 0px; margin: 0px; padding: 0px;"><i>regular expression</i><span style="border: 0px; font-style: italic; margin: 0px; padding: 0px;">,<span style="font-style: normal;"> il percorso dal quale ottenere il subrepository, e a destra la stringa che rimpiazzerà il nome simbolico di cui sopra (</span></span>xyz_core-project</span>). Per una descrizione più dettagliata, e sicuramente meno confusa, si rimanda alla pagina&nbsp;<a href="http://mercurial.selenic.com/wiki/SubrepoRemappingPlan" style="border: 0px; color: #4183c4; margin: 0px; padding: 0px; text-decoration: initial;">SubrepoRemappingPlan</a>.</div></li><li style="border: 0px; margin: 0px; padding: 0px;">A questo punto siamo pronti per consolidare la struttura del nuovo repository, ed a condividerla con il resto del mondo.<br style="margin-top: 0px;" />- In primo luogo eseguiamo il commit del nostro repository<br /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">$: hg commit -m "Messaggio di commit" --subrepos</code><br />Notare l'opzione&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">--subrepos</em>&nbsp;che indica al DVCS di estendere il comando in modo ricorsivo ai sottoprogetti indicati da file&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">.hgsub</em>. Al termine del comando, nella root del progetto verrà generato il file&nbsp;<em style="border: 0px; margin: 0px; padding: 0px;">.hgsubstate</em>&nbsp;che d'ora in poi avrà il compito di tener traccia della versione del sottoprogetto collegata al nostr repository (<a href="http://mercurial.aragost.com/kick-start/en/subrepositories/#id7" style="border: 0px; color: #4183c4; margin: 0px; padding: 0px; text-decoration: initial;">Subrepositories</a>).</li><li style="border: 0px; margin: 0px; padding: 0px;">Non resta che consolidare sul nostro server la nuova struttura del progetto:<br style="margin-top: 0px;" /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">$: hg push</code></li></ol></blockquote><div style="border: 0px; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; margin-top: 15px; padding: 0px;"></div><div style="text-align: justify;"><strong style="border: 0px; margin: 0px; padding: 0px;">NOTA:</strong>&nbsp;I comandi&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">hg pull</code>&nbsp;e&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">hg incoming</code>&nbsp;che ci consentono rispettivamente di aggiornare la copia locale del nostro repository, o più semplicemente di vedere quali e quante sono le differenze tra la copia locale e quella centralizzata, non hanno un'opzione che renda il comando ricorsivo (come l'opzione --subrepos vista per&nbsp;<code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">hg pull</code>), il che implica che la sincronizzazione del subrepository con la relativa versione centralizzata è a carico dell'utente. In altre parole, ci si dovrà spostare nella cartella del sotto progetto, e da questa posizione lanciare i comandi</div><div style="text-align: justify;"><br /></div><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">$: hg pull</code><br />e<br /><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">$: hg update</code><br /><div style="border: 0px; color: #333333; font-family: Helvetica, arial, freesans, clean, sans-serif; font-size: 14px; line-height: 22px; margin-top: 15px; padding: 0px;"><code style="background-color: #f8f8f8; border-bottom-left-radius: 3px; border-bottom-right-radius: 3px; border-top-left-radius: 3px; border-top-right-radius: 3px; border: 1px solid rgb(234, 234, 234); font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; margin: 0px; padding: 0px; white-space: nowrap;">Enjoy</code></div>