---
layout: post
title: Utilizzo di una dll .NET da codice 'nativo' (parte 1)
date: '2014-11-01T18:31:00.001+01:00'
author: Maurizio Attanasi
tags:
- ".NET"
- Ambienti di sviluppo
- Win32
modified_time: '2014-11-01T18:50:07.132+01:00'
blogger_id: tag:blogger.com,1999:blog-2699321970282050013.post-839650622901335299
blogger_orig_url: https://maurizioattanasi.blogspot.com/2014/11/utilizzo-di-una-dll-net-da-codice.html
---

<div class="separator" style="clear: both; text-align: center;"></div><div style="margin-left: 1em; margin-right: 1em; text-align: justify;">Circa un anno fa, un mio collega si è trovato nella condizione di dover utilizzare una dll sviluppata con tecnologia <strong>.NET</strong>, all’interno del software di controllo di un sistema di assemblaggio e test di componenti per il mercato automotive, sviluppato con un linguaggio <em>nativo</em>. Ovviamente la dll in questione non era <em>COM-aware</em>, ovvero non poteva essere utilizzata come un <em>ActiveX</em> (troppo facile). Poiché in azienda sono tra i pochi ad avere una certa esperienza sia con la tecnologia .NET che con linguaggi nativi, sono stato coinvolto nella ricerca di una soluzione al problema, e, dopo essermi documentato un po’, tra le varie soluzioni possibili, ho deciso di implementare quella illustrata nell’immagine che segue:</div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div style="margin-left: 1em; margin-right: 1em;"><img align="middle" height="480" src="https://drive.google.com/uc?export=view&amp;id=0BzugrVNPI3_rSkRJMndQakxFaDA" width="640" /></div><div style="text-align: justify;">In pratica, si tratta di sfruttare la possibilità di incorporare codice gestito in una dll C++, e creare quindi un wrapper che sia in grado di rendere fruibili metodi e proprietà esposti dalla dll .NET, ad un software <em>legacy</em>.&nbsp;</div><div style="text-align: justify;">Al fine di illustrare tale concetto, il resto del <em>memorandum</em>, che dividerò in due parti, si svilupperà nella scrittura di quanto segue:&nbsp;</div><div style="text-align: justify;">1. una dll C# che che esporti metodi e/o proprietà;&nbsp;</div><div style="text-align: justify;">2. un wrapper C++/CLI che renda visibili le interfacce della dll del punto precedente ad un software nativo;&nbsp;</div><div style="text-align: justify;">3. programma di test, scritto in codice nativo che importi la dll, prodotta allo step 2 e ne usi metodi e/o proprietà.&nbsp;</div><div style="text-align: justify;">Ho già condiviso l’intero progetto su <strong>GitHub</strong> ed è possibile raggiungerlo dal link che segue <a href="https://github.com/alien70/CLIWrapperDemo">CLIWrapperDemo</a>.</div><br /><br /><br /><h1 id="la-libreria-net" style="text-align: justify;">La libreria .NET</h1>Il primo passo sarà quello di implementare una libreria di classi .NET attorno alla quale costruiremo il nostro wrapper. Chiameremo la libreria <strong>GoogleMapsAPI</strong> che, com’è facile capire dal nome, sfrutterà le API di Google Maps, al fine di restituire le coordinate (longitudine e latitudine) dato un indirizzo. Per ulteriori informazioni sul servizio di geolocalizzazione ho fatto riferimento alla documentazione ufficiale <a href="https://developers.google.com/maps/documentation/geocoding/">Google Maps API Web Services</a>. Il risultato è una classe con tre proprietà ed un metodo.<br /><pre class="prettyprint"><code class="language-csharp hljs cs"><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;summary&gt;</span></span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> Returns the location latitude</span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;/summary&gt;</span></span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Latitude { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }<br /><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;summary&gt;</span></span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> Returns the location longitude</span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;/summary&gt;</span></span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Longitude { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }<br /><br /><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;summary&gt;</span></span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> Set the desired location address</span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;/summary&gt;</span></span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Address { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }<br /><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;summary&gt;</span></span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> Gets the location coordinates from the Google Maps API Web Service</span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> https://developers.google.com/maps/documentation/geocoding/</span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;/summary&gt;</span></span><br /><span class="hljs-comment"><span class="hljs-xmlDocTag">///</span> <span class="hljs-xmlDocTag">&lt;returns&gt;</span>true on success, false otherwise<span class="hljs-xmlDocTag">&lt;/returns&gt;</span></span><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">GetCoordinates</span>()<br />{<br />     ...<br />}<br /><br /></code></pre>Per testare immediatamente la dll prodotta ho implementato una semplice applicazione WinForm. Il risultato è illustrato nell’immagine che segue:<br /><img align="middle" alt="dotNETCrashTestDummy" src="http://drive.google.com/uc?export=view&amp;id=0BzugrVNPI3_rVUJyOTh4LTNqVGM" height="320" width="480" /><br />Ok, abbiamo una dll .NET e non ci resta che creare il wrapper e provare ad utilizzarlo nel nostro <em>vecchio</em> software <em>legacy</em>. <strong>We’ll find out in the next episode!</strong><br /><strong>Enjoy</strong>.<br /><table>    <tbody><tr>        <td height="35"><img align="left" alt="Creative Commons" height="35" src="https://drive.google.com/uc?export=view&amp;id=0BzugrVNPI3_rZkM1c1F2eEE5QW8" width="100" />        </td>        <td><img align="left" alt="Quality is not for sale" height="50" src="https://drive.google.com/uc?export=view&amp;id=0BzugrVNPI3_rYk9MaWk2SGwySDg" width="100" />        </td>    </tr></tbody></table>