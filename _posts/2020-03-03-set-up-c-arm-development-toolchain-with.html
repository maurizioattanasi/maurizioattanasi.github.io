---
layout: post
title: Set Up C++ ARM Development Toolchain with Visual Studio Code
date: '2020-03-03T21:00:00.001+01:00'
author: Maurizio Attanasi
tags:
- ARM
- IDE
- C++
- IoT
modified_time: '2020-03-03T22:41:18.240+01:00'
thumbnail: https://i.ytimg.com/vi/fJe8YJ9XTUg/default.jpg
blogger_id: tag:blogger.com,1999:blog-2699321970282050013.post-5526236200707597558
blogger_orig_url: https://maurizioattanasi.blogspot.com/2020/03/set-up-c-arm-development-toolchain-with.html
---

<h1 id="set-up-c-arm-development-toolchain-with-visual-studio-code"></h1><b><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">&lt;TLDR&gt;</span><span style="font-family: times, &quot;times new roman&quot;, serif;">&lt;/TLDR&gt;</span></b><span style="font-family: times, &quot;times new roman&quot;, serif;">The final goal this note is to simulate remote debugging of Microsoft Visual Studio 2017© on a Linux target computer (e.g. a tiny ARM computer, such as a Raspberry Pi © or a FriendlyARM NanoPi M1 Plus ©), but using Microsoft Visual Studio Code ©.</span><br /><h2 id="how-visual-studio-2017-does">How Visual Studio 2017 does</h2><br /><div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Following the great Scott Hanselman's article <a href="https://www.hanselman.com/blog/WritingAndDebuggingLinuxCApplicationsFromVisualStudioUsingTheWindowsSubsystemForLinux.aspx" target="_blank">Writing and debugging Linux C++ applications from Visual Studio using the “Windows Subsystem for Linux”</a>, let’s try to create a Cross-Platform Linux Console Application project with Visual Studio 2017.</span></div><div><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span></div><div class="separator" style="clear: both; text-align: center;"><a href="https://drive.google.com/uc?id=15I1Vt1X-I_c8QBy3T-MXFCQCU6nxVSQY" style="font-weight: bold; margin-left: 1em; margin-right: 1em;"><img alt="Figure 1 - New Project" border="0" height="276" src="https://drive.google.com/uc?id=15I1Vt1X-I_c8QBy3T-MXFCQCU6nxVSQY" width="400" /></a></div><br />The next step is to configure the IDE to connect <em>via ssh</em>, to the remote Linux client. From the <em>Tools-&gt;Options...</em> menu, search for the <em>Cross Platform-&gt;Connection Manager</em> item <br /><div class="separator" style="clear: both; text-align: center;"><br /></div><img alt="Figure 2 - Connection Manager" height="233" src="https://drive.google.com/uc?id=19nINX-dvuruNcMr2kUqoAp80uWLqLQgq" width="400" /><br /><br />and click on the <em>Add</em> button<strong></strong><br /><div class="separator" style="clear: both; text-align: center;"><code style="margin-left: 1em; margin-right: 1em;"><br /><img alt="Figure 3 - Connect to Remote" src="https://drive.google.com/uc?id=113ud6JhdkVhV0_sO77ZkyBrkJEmVkz9V" /><br /><br /></code></div><br /><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">and fill it with the ssh coordinates of the target client. Now we’re ready, let’s build our simple project and see what appens.</span><br /><br /><b><img alt="Figure 4 - Build Output" src="https://drive.google.com/uc?id=1bC47LEJcNYNj1a8CjbLYJJtpn60eoipi" /></b><br /></code><br /><br /><h3 id="debug-mode">Debug mode</h3><br /><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">The first time we’ll compile our project in <em><code>Debug Mode</code></em>, set a breakpoint in the source file and start a debug session. As shown in the following images the debugger stops correctly at the breakpoint,</span></code><br /><strong><code><br /><img alt="Figure 5 - Breakpoint" src="https://drive.google.com/uc?id=1OdvKhvzqZvpBobkmOXXyJIesgsXjPWY1" /><br /><br /></code></strong><br /><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">and the output is</span><br /><br /><b><img alt="Figure 6 - Linux Console" src="https://drive.google.com/uc?id=1jDtUNShNLk4xYYqvcBYZXpB6Lvam_inI" /></b><br /></code><br /><h3>Release mode</h3><br /><code></code><br /><div><code><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">For sake of completness, let’s compile our project also in <em><code>Release Mode</code></em></span></code></code></div><h3 id="lets-sum-up" style="font-weight: bold;"><code>Let’s sum up</code></h3><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Reading the build output shown in Figure 4, the steps taken by the <em><code>full fledged IDE</code></em> are:</span><br /></code><br /><ol><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Validating sources;</i></li><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Copying sources remotely to ‘192.168.0.101’;</i></li><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Validating architecture;</i></li><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Starting remote build;</i></li><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Compiling sources: main.cpp;</i></li><li><i style="font-family: times, &quot;times new roman&quot;, serif;">Start a debug session of the program running on the remote target;</i></li></ol><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Omitting the first step, the following are the ones that we will try to reproduce with <code>Visual Studio Code</code></span><b>©</b><br /></code><br /><h2 id="sources-copy" style="font-weight: bold;"><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Sources copy</span></code></h2><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">So the thing VS2017 does is copying all the necessary files to the remote target. Taking a close look to what has been copied, we have:</span></code><br /><div><code> </code><br /><pre><code><code>└── projects<br />    └── ConsoleApplication1<br />        ├── bin<br />        │&nbsp;&nbsp; └── ARM<br />        │&nbsp;&nbsp;     ├── Debug<br />        │&nbsp;&nbsp;     │&nbsp;&nbsp; └── ConsoleApplication1.out<br />        │&nbsp;&nbsp;     └── Release<br />        │&nbsp;&nbsp;         └── ConsoleApplication1.out<br />        ├── main.cpp<br />        └── obj<br />            └── ARM<br />                ├── Debug<br />                │&nbsp;&nbsp; └── main.o<br />                └── Release<br />                    └── main.o<br /><br />10 directories, 5 files<br />pi@NanoPi-M1-Plus:~$<br /></code></code></pre><pre style="font-weight: bold;"><code><code><br /></code></code></pre><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">We know that for that purpose, the IDE uses the previously configured <em><code>ssh</code></em> connection with the target. For that result we can use the same ssh connection to issue a <em><code>rsync</code></em> command, through a <em><code>VSCode Task</code></em>,</span></code></div><pre class="language-json"><code><code><code class="prism  language-json"><span class="token punctuation">{</span><br />    <span class="token comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span><br />    <span class="token comment">// for the documentation about the tasks.json format</span><br />    <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span><br />    <span class="token string">"tasks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br />        <span class="token punctuation">{</span><br />            <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span><br />            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span><br />            <span class="token string">"command"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br />                <span class="token string">"rsync -r -a -v -e ssh --delete --exclude '.vscode' $ {workspaceFolder}/ pi@192.168.0.102:/home/pi/projects/console-application/"</span><br />                <span class="token punctuation">]</span><br />        <span class="token punctuation">}</span><br />    <span class="token punctuation">]</span><br /><span class="token punctuation">}</span></code></code></code></pre><h2 id="build-project" style="font-weight: bold;">Build project</h2><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">With the same tecnique above we can also create the necessary folder structure and build our simple project</span></code><br /><div>{<br /><pre class="language-json"><code><code class="prism  language-json">    <span class="token comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span><br />    <span class="token comment">// for the documentation about the tasks.json format</span><br />    <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">,</span><br />    <span class="token string">"tasks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br />        <span class="token punctuation">{</span><br />            <span class="token string">"label"</span><span class="token punctuation">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span><br />            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span><br />            <span class="token string">"command"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br /><br />                <span class="token operator">...</span><br /><br />                <span class="token string">"&amp;amp;&amp;amp;"</span><span class="token punctuation">,</span><br />                <span class="token string">"ssh pi@192.168.0.102"</span><span class="token punctuation">,</span><br />                <span class="token string">"'mkdir /home/pi/projects/console-application/build"</span><span class="token punctuation">,</span><br />                <span class="token string">"&amp;amp;&amp;amp; cd /home/pi/projects/console-application/build"</span><span class="token punctuation">,</span><br />                <span class="token string">"&amp;amp;&amp;amp; cmake .. &amp;amp;&amp;amp; make'"</span><br />            <span class="token punctuation">]</span><br />        <span class="token punctuation">}</span><br />    <span class="token punctuation">]</span><br /><span class="token punctuation">}</span><b><br /></b></code></code></pre><h2 id="debug" style="font-weight: bold;">Debug</h2><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Last but not least we need a proper way to debug remotely our application. For that purpose we’ll configure a debug session using the VSCode C++ debugger features.</span></code></div><div><b><img alt="add-debug-config" src="https://drive.google.com/uc?id=1nZqt09-_qIcQm4GVla0AyKOw32_gJI4a" /></b><br /></div><div><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">First of all, from the debug launch dropdown menu</span></code></div><div><code><b><br /></b> <b><img alt="launch-over-ssh" src="https://drive.google.com/uc?id=1fH_EHWzHQoy3aIS6rNTds825OXgM0KOI" /></b><br /></code><br /><pre class="language-json" style="font-weight: bold;"><code><code class="prism  language-json"><span class="token punctuation"><br /></span></code></code></pre><pre class="language-json" style="font-weight: bold;"><code><code class="prism  language-json"><span class="token punctuation">{</span><br />    <span class="token string">"configurations"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br />        <span class="token punctuation">{</span><br />            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span><br />            <span class="token string">"request"</span><span class="token punctuation">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span><br />            <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Launch Program (SSH)"</span><span class="token punctuation">,</span><br />            <span class="token string">"target"</span><span class="token punctuation">:</span> <span class="token string">"./build/apps/console-application/console-application"</span><span class="token punctuation">,</span><br />            <span class="token string">"cwd"</span><span class="token punctuation">:</span> <span class="token string">"${workspaceRoot}"</span><span class="token punctuation">,</span><br />            <span class="token string">"windows"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                <span class="token string">"ssh"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                    <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span><br />                    <span class="token string">"cwd"</span><span class="token punctuation">:</span> <span class="token string">"/home/pi/projects/console-application"</span><span class="token punctuation">,</span><br />                    <span class="token string">"keyfile"</span><span class="token punctuation">:</span> <span class="token string">"C:\\Users\\mauri\\.ssh\\id_rsa"</span><span class="token punctuation">,</span><br />                    <span class="token string">"user"</span><span class="token punctuation">:</span> <span class="token string">"pi"</span><span class="token punctuation">,</span><br />                <span class="token punctuation">}</span><br />            <span class="token punctuation">}</span><span class="token punctuation">,</span><br />            <span class="token string">"osx"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                <span class="token string">"ssh"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                    <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span><br />                    <span class="token string">"cwd"</span><span class="token punctuation">:</span> <span class="token string">"/home/pi/projects/console-application"</span><span class="token punctuation">,</span><br />                    <span class="token string">"keyfile"</span><span class="token punctuation">:</span> <span class="token string">"/Users/maurizioattanasi/.ssh/id_rsa"</span><span class="token punctuation">,</span><br />                    <span class="token string">"user"</span><span class="token punctuation">:</span> <span class="token string">"pi"</span><span class="token punctuation">,</span><br />                <span class="token punctuation">}</span>       <br />            <span class="token punctuation">}</span><span class="token punctuation">,</span><br />            <span class="token string">"linux"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                <span class="token string">"ssh"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><br />                    <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"192.168.1.2"</span><span class="token punctuation">,</span><br />                    <span class="token string">"cwd"</span><span class="token punctuation">:</span> <span class="token string">"/home/pi/projects/console-application"</span><span class="token punctuation">,</span><br />                    <span class="token string">"keyfile"</span><span class="token punctuation">:</span> <span class="token string">"/Users/maurizioattanasi/.ssh/id_rsa"</span><span class="token punctuation">,</span><br />                    <span class="token string">"user"</span><span class="token punctuation">:</span> <span class="token string">"pi"</span><span class="token punctuation">,</span><br />                <span class="token punctuation">}</span>       <br />            <span class="token punctuation">}</span><span class="token punctuation">,</span><br />            <span class="token string">"preLaunchTask"</span><span class="token punctuation">:</span> <span class="token string">"build"</span><br />        <span class="token punctuation">}</span><br />    <span class="token punctuation">]</span><br /><span class="token punctuation">}</span><br /></code></code></pre><h2 id="demo" style="font-weight: bold;">Demo</h2><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">In the following video, available on my <a href="https://www.youtube.com/channel/UCaEsggT05SZOLrAWcMXL7ig?view_as=public">YouTube Channel</a>, there is a short demo of the <em><code>toolchain</code></em> in action.</span></code></div><div><code><b><br /></b> </code></div><br /><div class="separator" style="clear: both; font-weight: bold; text-align: center;"><code><a href="https://youtu.be/fJe8YJ9XTUg" style="margin-left: 1em; margin-right: 1em;"><img alt="Watch the video" src="https://img.youtube.com/vi/fJe8YJ9XTUg/0.jpg" /></a></code></div><code><br /><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">The code of this note is available&nbsp;<a href="https://github.com/alien70/vscode-arm-cpp-toolchain" target="_blank">here</a></span></code><br /><code><br /></code><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;">Enjoy</span></code><br /><div><code><span style="font-family: &quot;times&quot; , &quot;times new roman&quot; , serif;"><br /></span></code></div>